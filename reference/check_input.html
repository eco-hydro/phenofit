<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>check_input — check_input • phenofit</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="check_input — check_input" />
<meta property="og:description" content="Check input data, interpolate NA values in y, remove spike values, and set
weights for NA in y and w." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">phenofit</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/phenofit-procedures.html">Detailed procedures of phenofit</a>
    </li>
    <li>
      <a href="../articles/phenofit_CA-NS6.html">Extract vegetation phenology from MOD13A1 EVI</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/kongdd/phenofit/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>check_input</h1>
    <small class="dont-index">Source: <a href='https://github.com/kongdd/phenofit/blob/master/R/check_input.R'><code>R/check_input.R</code></a></small>
    <div class="hidden name"><code>check_input.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Check input data, interpolate NA values in y, remove spike values, and set
weights for NA in y and w.</p>
    </div>

    <pre class="usage"><span class='fu'>check_input</span><span class='op'>(</span>
  <span class='va'>t</span>,
  <span class='va'>y</span>,
  <span class='va'>w</span>,
  <span class='va'>QC_flag</span>,
  <span class='va'>nptperyear</span>,
  south <span class='op'>=</span> <span class='cn'>FALSE</span>,
  Tn <span class='op'>=</span> <span class='cn'>NULL</span>,
  wmin <span class='op'>=</span> <span class='fl'>0.2</span>,
  wsnow <span class='op'>=</span> <span class='fl'>0.8</span>,
  <span class='va'>ymin</span>,
  <span class='va'>missval</span>,
  <span class='va'>maxgap</span>,
  alpha <span class='op'>=</span> <span class='fl'>0.02</span>,
  alpha_high <span class='op'>=</span> <span class='cn'>NULL</span>,
  date_start <span class='op'>=</span> <span class='cn'>NULL</span>,
  date_end <span class='op'>=</span> <span class='cn'>NULL</span>,
  mask_spike <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>t</th>
      <td><p>Numeric vector, <code>Date</code> variable</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>Numeric vector, vegetation index time-series</p></td>
    </tr>
    <tr>
      <th>w</th>
      <td><p>(optional) Numeric vector, weights of <code>y</code>. If not specified,
weights of all <code>NA</code> values will be <code>wmin</code>, the others will be 1.0.</p></td>
    </tr>
    <tr>
      <th>QC_flag</th>
      <td><p>Factor (optional) returned by <code>qcFUN</code>, levels should be
in the range of <code><a href='https://rdrr.io/r/base/c.html'>c("snow", "cloud", "shadow", "aerosol", "marginal", "good")</a></code>, others will be categoried into <code>others</code>. <code>QC_flag</code> is
used for visualization in <code><a href='get_pheno.html'>get_pheno()</a></code> and <code><a href='plot_curvefits.html'>plot_curvefits()</a></code>.</p></td>
    </tr>
    <tr>
      <th>nptperyear</th>
      <td><p>Integer, number of images per year.</p></td>
    </tr>
    <tr>
      <th>south</th>
      <td><p>Boolean. In south hemisphere, growing year is 1 July to the
following year 31 June; In north hemisphere, growing year is 1 Jan to 31 Dec.</p></td>
    </tr>
    <tr>
      <th>Tn</th>
      <td><p>Numeric vector, night temperature, default is null. If provided,
Tn is used to help divide ungrowing period, and then get background value in
ungrowing season (see details in <code><a href='backval.html'>backval()</a></code>).</p></td>
    </tr>
    <tr>
      <th>wmin</th>
      <td><p>Double, minimum weight of bad points, which could be smaller
the weight of snow, ice and cloud.</p></td>
    </tr>
    <tr>
      <th>wsnow</th>
      <td><p>Doulbe. Reset the weight of snow points, after get <code>ylu</code>.
Snow flag is an important flag of ending of growing
season. Snow points is more valuable than marginal points. Hence, the weight
of snow should be great than that of <code>marginal</code>.</p></td>
    </tr>
    <tr>
      <th>ymin</th>
      <td><p>If specified, <code>ylu[1]</code> is constrained greater than ymin. This
value is critical for bare, snow/ice land, where vegetation amplitude is quite
small. Generally, you can set ymin=0.08 for NDVI, ymin=0.05 for EVI,
ymin=0.5 gC m-2 s-1 for GPP.</p></td>
    </tr>
    <tr>
      <th>missval</th>
      <td><p>Double, which is used to replace NA values in y. If missing,
the default vlaue is <code>ylu[1]</code>.</p></td>
    </tr>
    <tr>
      <th>maxgap</th>
      <td><p>Integer, nptperyear/4 will be a suitable value. If continuous
missing value numbers less than maxgap, then interpolate those NA values by
zoo::na.approx; If false, then replace those NA values with a constant value
<code>ylu[1]</code>. <br />
Replacing NA values with a constant missing value (e.g. background value ymin)
is inappropriate for middle growing season points. Interpolating all values
by na.approx, it is unsuitable for large number continous missing segments,
e.g. in the start or end of growing season.</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>Double, in <code>[0,1]</code>, quantile prob of ylu_min.</p></td>
    </tr>
    <tr>
      <th>alpha_high</th>
      <td><p>Double, <code>[0,1]</code>, quantile prob of <code>ylu_max</code>. If not
specified, <code>alpha_high=alpha</code>.</p></td>
    </tr>
    <tr>
      <th>date_start, date_end</th>
      <td><p>starting and ending date of the original vegetation
time-sereis (before <code>add_HeadTail</code>)</p></td>
    </tr>
    <tr>
      <th>mask_spike</th>
      <td><p>Boolean. Whether to remove spike values?</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Others will be ignored.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list object returned:</p><ul>
<li><p><code>t</code> : Numeric vector</p></li>
<li><p><code>y0</code>: Numeric vector, original vegetation time-series.</p></li>
<li><p><code>y</code> : Numeric vector, checked vegetation time-series, <code>NA</code> values are interpolated.</p></li>
<li><p><code>w</code> : Numeric vector</p></li>
<li><p><code>Tn</code>: Numeric vector</p></li>
<li><p><code>ylu</code>: = <code>[ymin, ymax]</code>. <code>w_critical</code> is used to filter not too bad values.</p>
<p>If the percentage good values (w=1) is greater than 30\<!-- %, then \code{w_critical}=1. --></p>
<p>The else, if the percentage of w &gt;= 0.5 points is greater than 10\<!-- %, then -->
<code>w_critical</code>=0.5. In boreal regions, even if the percentage of w &gt;= 0.5
points is only 10\<!-- %, we still can't set \code{w_critical=wmin}. --></p>
<p>We can't rely on points with the wmin weights. Then,  <br />
<code>y_good = y[w &gt;= w_critical]</code>,  <br />
<code>ymin = pmax( quantile(y_good, alpha/2), 0)</code>  <br /> <code>ymax = max(y_good)</code>.</p></li>
</ul>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='backval.html'>backval()</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"CA_NS6"</span><span class='op'>)</span>
<span class='va'>d</span> <span class='op'>=</span> <span class='va'>CA_NS6</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span>
</div><div class='output co'>#&gt;      site      y       date          t   w QC_flag
#&gt; 1: CA-NS6 0.1370 2013-01-01 2013-01-11 0.2    snow
#&gt; 2: CA-NS6 0.1140 2013-01-17 2013-01-31 0.2    snow
#&gt; 3: CA-NS6 0.1124 2013-02-02 2013-02-15 0.2    snow
#&gt; 4: CA-NS6 0.0750 2013-02-18 2013-03-01 0.2    snow
#&gt; 5: CA-NS6 0.0915 2013-03-06 2013-03-15 0.2    snow
#&gt; 6: CA-NS6 0.0832 2013-03-22 2013-04-01 0.2    snow</div><div class='input'>
<span class='va'>nptperyear</span> <span class='op'>&lt;-</span> <span class='fl'>23</span>
<span class='va'>INPUT</span> <span class='op'>&lt;-</span> <span class='fu'>check_input</span><span class='op'>(</span><span class='va'>d</span><span class='op'>$</span><span class='va'>t</span>, <span class='va'>d</span><span class='op'>$</span><span class='va'>y</span>, <span class='va'>d</span><span class='op'>$</span><span class='va'>w</span>, QC_flag <span class='op'>=</span> <span class='va'>d</span><span class='op'>$</span><span class='va'>QC_flag</span>,
     nptperyear <span class='op'>=</span> <span class='va'>nptperyear</span>, south <span class='op'>=</span> <span class='cn'>FALSE</span>, 
     maxgap <span class='op'>=</span> <span class='va'>nptperyear</span><span class='op'>/</span><span class='fl'>4</span>, alpha <span class='op'>=</span> <span class='fl'>0.02</span>, wmin <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span>
<span class='fu'><a href='plot_input.html'>plot_input</a></span><span class='op'>(</span><span class='va'>INPUT</span><span class='op'>)</span>
</div><div class='img'><img src='check_input-1.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Dongdong Kong, Mingzhong Xiao, Yongqiang Zhang, Xihui Gu, Jianjian Cui.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


